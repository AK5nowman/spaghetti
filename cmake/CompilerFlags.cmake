set(CMAKE_DEBUG_POSTFIX "d")

set(COMMON_FLAGS)
set(COMMON_FLAGS_C)
set(COMMON_FLAGS_CXX)
set(COMMON_FLAGS_DEBUG)
set(COMMON_FLAGS_RELEASE)
set(COMMON_FLAGS_LINKER)
set(COMMON_DEFINITIONS)
set(COMMON_DEFINITIONS_DEBUG)
set(COMMON_DEFINITIONS_RELEASE)
set(COMMON_WARNINGS)

if (MSVC)
  set(COMMON_FLAGS "/MP")
  set(COMMON_FLAGS_CXX "/EHsc /std:c++latest")
  set(COMMON_DEFINITIONS "-DUNICODE -D_UNICODE -D_CRT_SECURE_NO_WARNINGS -DNOMINMAX")
  set(COMMON_WARNINGS "/W3 /WX")
elseif (GCC OR CLANG)
  set(COMMON_FLAGS "-march=native -mtune=native -pipe -fvisibility=hidden -pedantic -fstack-protector")
  if (CLANG AND NOT WIN32)
    set(COMMON_FLAGS "${COMMON_FLAGS} -fPIC")
  endif ()

  set(COMMON_FLAGS_DEBUG "-g3 -ggdb3 -O0 -fno-inline -fno-omit-frame-pointer -fno-optimize-sibling-calls")
  set(COMMON_FLAGS_RELEASE "-O3 -flto -fuse-linker-plugin")
  set(COMMON_FLAGS_LINKER "-Wl,-O1 -Wl,--fatal-warnings -Wl,--discard-all -Wl,--build-id=sha1")
  set(COMMON_DEFINITIONS_DEBUG "-D_DEBUG")
  set(COMMON_DEFINITIONS_RELEASE "-DNDEBUG")
  if (GCC)
    set(COMMON_WARNINGS "")
  elseif (CLANG)
    set(COMMON_FLAGS_CXX "-stdlib=libc++")
    set(COMMON_WARNINGS "-Weverything -Werror -Wno-c++98-compat -Wno-padded -Wno-exit-time-destructors")
    set(COMMON_WARNINGS "${COMMON_WARNINGS} -Wno-weak-vtables -Wno-global-constructors")
  endif ()
else ()
  message(FATAL_ERROR "Unknown compiler")
endif ()

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${COMMON_FLAGS} ${COMMON_FLAGS_C} ${COMMON_DEFINITIONS}")
set(CMAKE_C_FLAGS_DEBUG "${CMAKE_C_FLAGS_DEBUG} ${COMMON_FLAGS_DEBUG} ${COMMON_WARNINGS} ${COMMON_DEFINITIONS_DEBUG}")
set(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} ${COMMON_FLAGS_RELEASE} ${COMMON_DEFINITIONS_RELEASE}")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${COMMON_FLAGS} ${COMMON_FLAGS_CXX} ${COMMON_DEFINITIONS}")
set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${COMMON_FLAGS_DEBUG} ${COMMON_WARNINGS} ${COMMON_DEFINITIONS_DEBUG}")
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} ${COMMON_FLAGS_RELEASE} ${COMMON_DEFINITIONS_RELEASE}")
